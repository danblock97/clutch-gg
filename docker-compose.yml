services:
  app:
    image: clutch-gg:local
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Forward public envs at build time so Next.js can inline them
        NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
        NEXT_PUBLIC_SUPABASE_KEY: ${NEXT_PUBLIC_SUPABASE_KEY}
        NEXT_PUBLIC_UPDATE_API_KEY: ${NEXT_PUBLIC_UPDATE_API_KEY}
        NEXT_PUBLIC_SITE_URL: ${NEXT_PUBLIC_SITE_URL}
        NEXT_PUBLIC_BASE_URL: ${NEXT_PUBLIC_BASE_URL}
        NEXT_PUBLIC_OUTAGE_MESSAGE: ${NEXT_PUBLIC_OUTAGE_MESSAGE}
        NEXT_PUBLIC_FEATURE_ANNOUNCEMENT: ${NEXT_PUBLIC_FEATURE_ANNOUNCEMENT}
    environment:
      - NODE_ENV=production
      - PORT=3000
      # Pass-through runtime env vars (Dokploy injects values)
      - NEXT_PUBLIC_SUPABASE_URL
      - NEXT_PUBLIC_SUPABASE_KEY
      - NEXT_PUBLIC_UPDATE_API_KEY
      - NEXT_PUBLIC_SITE_URL
      - NEXT_PUBLIC_BASE_URL
      - NEXT_PUBLIC_OUTAGE_MESSAGE
      - NEXT_PUBLIC_FEATURE_ANNOUNCEMENT
      - SUPABASE_SERVICE_KEY
      - MONGODB_URI
      - RIOT_API_KEY
      - TFT_API_KEY
      - RIOT_CLIENT_ID
      - RIOT_CLIENT_SECRET
      - RIOT_REDIRECT_URI
      - POST_LOGOUT_REDIRECT_URI
      - INTERNAL_API_KEY
      - SITE_URL
    expose:
      - "3000"
    restart: unless-stopped
